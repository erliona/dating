# Sprint 5 Task 1: ะะฝะตะดัะตะฝะธะต ะฐะฝะฐะปะธัะธะบะธ

## ะะฑะทะพั

ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะบะพะผะฟะปะตะบัะฝะฐั ัะธััะตะผะฐ ัะฑะพัะฐ ะผะตััะธะบ ะธ ะฐะฝะฐะปะธัะธะบะธ ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ัะฐะฑะพัั ะฟัะธะปะพะถะตะฝะธั ะทะฝะฐะบะพะผััะฒ. ะกะธััะตะผะฐ ะฒะบะปััะฐะตั ะฒ ัะตะฑั:
- ะะพะดัะปั ัะฑะพัะฐ ะธ ะฐะณัะตะณะฐัะธะธ ะฐะฝะฐะปะธัะธะบะธ ะธะท ะฑะฐะทั ะดะฐะฝะฝัั
- ะกะธััะตะผั ะพััะปะตะถะธะฒะฐะฝะธั ะผะตััะธะบ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะฝััััะผะตะฝัะฐัะธั ะบะพะดะฐ ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฑะพัะฐ ะดะฐะฝะฝัั
- ะะฐัะฑะพัะดั ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะผะตััะธะบ
- ะะฝัะตะณัะฐัะธั ั ัััะตััะฒัััะตะน ะธะฝััะฐััััะบัััะพะน ะผะพะฝะธัะพัะธะฝะณะฐ

## โ ะัะฟะพะปะฝะตะฝะฝัะต ะะฐะฑะพัั

### 1. ะะพะดัะปั Analytics (`bot/analytics.py`)

ะกะพะทะดะฐะฝ ะบะพะผะฟะปะตะบัะฝัะน ะผะพะดัะปั ะดะปั ัะฑะพัะฐ ะธ ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั ะฟัะธะปะพะถะตะฝะธั.

#### ะะปะฐััั ะธ ะบะพะผะฟะพะฝะตะฝัั:

**`AnalyticsMetrics`** - dataclass ะดะปั ััะฐะฝะตะฝะธั ะผะตััะธะบ:
- `total_users` - ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- `active_users_24h`, `active_users_7d` - ะฐะบัะธะฒะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ
- `total_matches`, `total_interactions` - ะบะพะปะธัะตััะฒะพ ะผะฐััะตะน ะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- `likes_sent`, `dislikes_sent` - ะพัะฟัะฐะฒะปะตะฝะฝัะต ะปะฐะนะบะธ ะธ ะดะธะทะปะฐะนะบะธ
- `match_rate` - ะฟัะพัะตะฝั ััะฟะตัะฝัั ะผะฐััะตะน
- `avg_age` - ััะตะดะฝะธะน ะฒะพะทัะฐัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- `engagement_rate` - ะฟัะพัะตะฝั ะฒะพะฒะปะตััะฝะฝะพััะธ
- `gender_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั
- `location_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะปะพะบะฐัะธัะผ
- `goal_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ัะตะปัะผ ะทะฝะฐะบะพะผััะฒะฐ
- `popular_interests` - ะฟะพะฟัะปััะฝัะต ะธะฝัะตัะตัั

**`AnalyticsCollector`** - ะบะปะฐัั ะดะปั ัะฑะพัะฐ ะดะฐะฝะฝัั ะธะท ะฑะฐะทั:

ะัะฝะพะฒะฝัะต ะผะตัะพะดั:
```python
async def get_overall_metrics() -> AnalyticsMetrics
    """ะะพะปััะธัั ะพะฑัะธะต ะผะตััะธะบะธ ัะธััะตะผั"""

async def get_time_series_metrics(days: int = 30) -> dict
    """ะะพะปััะธัั ะฒัะตะผะตะฝะฝัะต ััะดั ะผะตััะธะบ"""

async def get_user_analytics(user_id: int) -> dict
    """ะะพะปััะธัั ะฐะฝะฐะปะธัะธะบั ะดะปั ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั"""

async def get_matching_quality_metrics() -> dict
    """ะะพะปััะธัั ะผะตััะธะบะธ ะบะฐัะตััะฒะฐ ะฐะปะณะพัะธัะผะฐ ะฟะพะดะฑะพัะฐ"""
```

ะัะฟะพะผะพะณะฐัะตะปัะฝัะต ะผะตัะพะดั ะดะปั ัะฐะฑะพัั ั ะะ:
- `_get_total_users()` - ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- `_get_average_age()` - ััะตะดะฝะธะน ะฒะพะทัะฐัั
- `_get_total_matches()` - ะบะพะปะธัะตััะฒะพ ะผะฐััะตะน
- `_get_total_interactions()` - ะบะพะปะธัะตััะฒะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- `_get_likes_count()`, `_get_dislikes_count()` - ััะฐัะธััะธะบะฐ ะปะฐะนะบะพะฒ/ะดะธะทะปะฐะนะบะพะฒ
- `_get_active_users_count()` - ะบะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- `_get_gender_distribution()` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั
- `_get_location_distribution()` - ัะพะฟ ะปะพะบะฐัะธะน
- `_get_goal_distribution()` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะตะปะตะน

**`MetricsCounter`** - ัััััะธะบ ะผะตััะธะบ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:

```python
def increment(metric_name: str, value: int = 1) -> None
    """ะฃะฒะตะปะธัะธัั ัััััะธะบ ะผะตััะธะบะธ"""

def get_metrics() -> dict
    """ะะพะปััะธัั ะฒัะต ะผะตััะธะบะธ ั uptime"""

def reset() -> None
    """ะกะฑัะพัะธัั ะฒัะต ัััััะธะบะธ"""
```

ะะตััะธะบะธ ะฒะบะปััะฐัั:
- ะัะตะผั ัะฐะฑะพัั (uptime)
- ะกััััะธะบะธ ะฒัะตั ัะพะฑััะธะน
- ะัะตะผั ััะฐััะฐ ัะธััะตะผั

**ะคัะฝะบัะธะธ ะพััะปะตะถะธะฒะฐะฝะธั ัะพะฑััะธะน:**

```python
track_command(command_name: str)
    """ะััะปะตะดะธัั ะฒัะฟะพะปะฝะตะฝะธะต ะบะพะผะฐะฝะดั ะฑะพัะฐ"""
    # ะะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตั command_{name} ะธ commands_total

track_interaction(interaction_type: str)
    """ะััะปะตะดะธัั ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน"""
    # ะะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตั interaction_{type} ะธ interactions_total

track_profile_action(action: str)
    """ะััะปะตะดะธัั ะดะตะนััะฒะธะต ั ะฟัะพัะธะปะตะผ"""
    # ะะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะปะธัะธะฒะฐะตั profile_{action} ะธ profiles_total
```

### 2. ะะฝััััะผะตะฝัะฐัะธั Bot Handlers (`bot/main.py`)

ะะพะฑะฐะฒะปะตะฝะพ ะพััะปะตะถะธะฒะฐะฝะธะต ะผะตััะธะบ ะฒะพ ะฒัะต ะบะปััะตะฒัะต ะพะฑัะฐะฑะพััะธะบะธ:

#### ะะพะผะฐะฝะดั ะฑะพัะฐ:
- โ `/start` - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `command_start`
- โ `/cancel` - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `command_cancel`
- โ `/debug` - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `command_debug`
- โ `/matches` - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `command_matches`
- โ `/stats` - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `command_stats`
- โ `/analytics` - ะฝะพะฒะฐั ะบะพะผะฐะฝะดะฐ ะดะปั ะฟัะพัะผะพััะฐ ัะธััะตะผะฝะพะน ะฐะฝะฐะปะธัะธะบะธ

#### ะะทะฐะธะผะพะดะตะนััะฒะธั:
- โ Like - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `interaction_like`
- โ Dislike - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `interaction_dislike`
- โ Match - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `interaction_match`

#### ะะตะนััะฒะธั ั ะฟัะพัะธะปัะผะธ:
- โ Create - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `profile_create`
- โ Update - ะพััะปะตะถะธะฒะฐะตััั ะบะฐะบ `profile_update`

### 3. ะะพะฒะฐั ะบะพะผะฐะฝะดะฐ `/analytics`

ะะพะฑะฐะฒะปะตะฝะฐ ะบะพะผะฐะฝะดะฐ ะดะปั ะฟะพะปััะตะฝะธั ัะธััะตะผะฝะพะน ะฐะฝะฐะปะธัะธะบะธ:

**ะะพะบะฐะทัะฒะฐะตั:**
- ๐ฅ **ะะพะปัะทะพะฒะฐัะตะปะธ**: ะฒัะตะณะพ, ััะตะดะฝะธะน ะฒะพะทัะฐัั, ะฒะพะฒะปะตััะฝะฝะพััั
- ๐น๐บ **ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั**: ะบะพะปะธัะตััะฒะพ male/female
- ๐ **ะะทะฐะธะผะพะดะตะนััะฒะธั**: ะผะฐััะธ, ะปะฐะนะบะธ, ะดะธะทะปะฐะนะบะธ, match rate
- ๐ **ะขะพะฟ ะปะพะบะฐัะธะน**: 5 ัะฐะผัั ะฟะพะฟัะปััะฝัั ะปะพะบะฐัะธะน
- ๐ฏ **ะฆะตะปะธ ะทะฝะฐะบะพะผััะฒะฐ**: ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ัะตะปัะผ
- โก **Real-time ะผะตััะธะบะธ**: uptime, ะฒัะฟะพะปะฝะตะฝะฝัะต ะบะพะผะฐะฝะดั, ะฒะทะฐะธะผะพะดะตะนััะฒะธั

**ะัะธะผะตั ะฒัะฒะพะดะฐ:**
```
๐ ะกะธััะตะผะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ

๐ฅ ะะพะปัะทะพะฒะฐัะตะปะธ:
  โข ะัะตะณะพ: 150
  โข ะกัะตะดะฝะธะน ะฒะพะทัะฐัั: 26.3 ะปะตั
  โข ะะพะฒะปะตััะฝะฝะพััั: 68.0%

๐น๐บ ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั:
  โข male: 78
  โข female: 72

๐ ะะทะฐะธะผะพะดะตะนััะฒะธั:
  โข ะะฐััะตะน: 45
  โข ะะฐะนะบะพะฒ: 210
  โข ะะธะทะปะฐะนะบะพะฒ: 95
  โข Match rate: 21.4%

๐ ะขะพะฟ ะปะพะบะฐัะธะน:
  โข ะะพัะบะฒะฐ: 45
  โข ะกะฐะฝะบั-ะะตัะตัะฑััะณ: 28
  โข ะะฐะทะฐะฝั: 15
  โข ะะบะฐัะตัะธะฝะฑััะณ: 12
  โข ะะพะฒะพัะธะฑะธััะบ: 10

๐ฏ ะฆะตะปะธ ะทะฝะฐะบะพะผััะฒะฐ:
  โข serious: 85
  โข casual: 45
  โข friendship: 20

โก ะะตััะธะบะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:
  โข Uptime: 12.5ั
  โข ะะพะผะฐะฝะด ะฒัะฟะพะปะฝะตะฝะพ: 523
  โข ะะทะฐะธะผะพะดะตะนััะฒะธะน: 305
```

### 4. ะะฐัะฑะพัะด Business Metrics

ะกะพะทะดะฐะฝ ะฝะพะฒัะน Grafana ะดะฐัะฑะพัะด `dating-app-business-metrics.json` ั ะฟะฐะฝะตะปัะผะธ:

#### ะกัะฐัะธััะธัะตัะบะธะต ะฟะฐะฝะตะปะธ:
1. **Total Users** - ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน (stat)
2. **Total Matches** - ะบะพะปะธัะตััะฒะพ ะผะฐััะตะน (stat)
3. **Match Rate (%)** - ะฟัะพัะตะฝั ััะฟะตัะฝัั ะผะฐััะตะน (gauge, 0-100%)
4. **Engagement Rate (%)** - ะฟัะพัะตะฝั ะฒะพะฒะปะตััะฝะฝะพััะธ (gauge, 0-100%)

#### ะัะฐัะธะบะธ ะฒัะตะผะตะฝะฝัั ััะดะพะฒ:
5. **Commands Executed Over Time** - ะฒัะฟะพะปะฝะตะฝะธะต ะบะพะผะฐะฝะด (graph)
   - ะะพะผะฐะฝะดั ะฒ ัะตะบัะฝะดั
   
6. **Interactions Over Time** - ะฒะทะฐะธะผะพะดะตะนััะฒะธั (graph)
   - ะะฑัะธะต ะฒะทะฐะธะผะพะดะตะนััะฒะธั/ัะตะบ
   - ะะฐะนะบะธ/ัะตะบ
   - ะะธะทะปะฐะนะบะธ/ัะตะบ
   - ะะฐััะธ/ัะตะบ

7. **Profile Actions** - ะดะตะนััะฒะธั ั ะฟัะพัะธะปัะผะธ (graph)
   - ะกะพะทะดะฐะฝะธะต ะฟัะพัะธะปะตะน
   - ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพัะธะปะตะน
   - ะฃะดะฐะปะตะฝะธะต ะฟัะพัะธะปะตะน

8. **Command Distribution** - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะบะพะผะฐะฝะด (piechart)
   - ะขะพะฟ-5 ะบะพะผะฐะฝะด

**ะะฐัััะพะนะบะธ ะดะฐัะฑะพัะดะฐ:**
- ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะบะฐะถะดัะต 30 ัะตะบัะฝะด
- ะัะตะผะตะฝะฝะพะน ะดะธะฐะฟะฐะทะพะฝ: ะฟะพัะปะตะดะฝะธะต 6 ัะฐัะพะฒ
- ะฆะฒะตัะพะฒัะต ะฟะพัะพะณะธ ะดะปั ะผะตััะธะบ (ะบัะฐัะฝัะน/ะถัะปััะน/ะทะตะปัะฝัะน)

### 5. ะะฑะฝะพะฒะปะตะฝะธะต Bot Context

ะะฐััะธัะตะฝ ะบะพะฝัะตะบัั ะฑะพัะฐ ะดะปั ััะฐะฝะตะฝะธั database engine:

```python
ENGINE_CONTEXT_KEY = "engine"

def attach_bot_context(
    bot: Bot,
    config: BotConfig,
    repository: ProfileRepository,
    settings_repository: UserSettingsRepository,
    interaction_repository: InteractionRepository,
    match_repository: MatchRepository,
    rate_limiter: RateLimiter,
    engine: Any = None,  # โ ะะพะฑะฐะฒะปะตะฝ ะฟะฐัะฐะผะตัั
) -> None:
    """Populate the bot context with common application dependencies."""
    # ... ัะพััะฐะฝะตะฝะธะต ะฒัะตั ะทะฐะฒะธัะธะผะพััะตะน
    if engine is not None:
        _set_bot_context_value(bot, ENGINE_CONTEXT_KEY, engine)
```

ะญัะพ ะฟะพะทะฒะพะปัะตั ะบะพะผะฐะฝะดะต `/analytics` ัะพะทะดะฐะฒะฐัั session factory ะดะปั ะทะฐะฟัะพัะพะฒ ะบ ะะ.

### 6. Comprehensive Tests

ะกะพะทะดะฐะฝ ัะฐะนะป `tests/test_analytics.py` ั 24 ัะตััะฐะผะธ:

#### TestMetricsCounter (6 ัะตััะพะฒ)
- โ `test_increment_single_metric` - ะพะดะธะฝะพัะฝะพะต ัะฒะตะปะธัะตะฝะธะต
- โ `test_increment_multiple_times` - ะผะฝะพะถะตััะฒะตะฝะฝะพะต ัะฒะตะปะธัะตะฝะธะต
- โ `test_increment_with_value` - ัะฒะตะปะธัะตะฝะธะต ะฝะฐ ะทะฝะฐัะตะฝะธะต
- โ `test_multiple_metrics` - ะฝะตัะบะพะปัะบะพ ะผะตััะธะบ
- โ `test_get_metrics_includes_uptime` - ะฟัะพะฒะตัะบะฐ uptime
- โ `test_reset_clears_counters` - ัะฑัะพั ัััััะธะบะพะฒ

#### TestTrackingFunctions (3 ัะตััะฐ)
- โ `test_track_command` - ะพััะปะตะถะธะฒะฐะฝะธะต ะบะพะผะฐะฝะด
- โ `test_track_interaction` - ะพััะปะตะถะธะฒะฐะฝะธะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- โ `test_track_profile_action` - ะพััะปะตะถะธะฒะฐะฝะธะต ะดะตะนััะฒะธะน ั ะฟัะพัะธะปัะผะธ

#### TestAnalyticsCollector (13 ัะตััะพะฒ)
- โ `test_get_total_users` - ะฟะพะดัััั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ `test_get_average_age` - ััะตะดะฝะธะน ะฒะพะทัะฐัั
- โ `test_get_gender_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั
- โ `test_get_total_matches` - ะบะพะปะธัะตััะฒะพ ะผะฐััะตะน
- โ `test_get_interaction_counts` - ะบะพะปะธัะตััะฒะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- โ `test_match_rate_calculation` - ัะฐัััั match rate
- โ `test_engagement_rate` - ัะฐัััั engagement rate
- โ `test_location_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะปะพะบะฐัะธัะผ
- โ `test_goal_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ัะตะปัะผ
- โ `test_get_user_analytics` - ะฐะฝะฐะปะธัะธะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- โ `test_get_user_analytics_nonexistent_user` - ะฝะตัััะตััะฒัััะธะน ะฟะพะปัะทะพะฒะฐัะตะปั
- โ `test_get_matching_quality_metrics` - ะบะฐัะตััะฒะพ ะผะฐััะธะฝะณะฐ
- โ `test_empty_database` - ะฟัััะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั

#### TestAnalyticsMetrics (2 ัะตััะฐ)
- โ `test_default_values` - ะทะฝะฐัะตะฝะธั ะฟะพ ัะผะพะปัะฐะฝะธั
- โ `test_custom_values` - ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะต ะทะฝะฐัะตะฝะธั

**ะะตะทัะปััะฐั**: ะัะต 254 ัะตััะฐ ะฟัะพัะพะดัั ััะฟะตัะฝะพ (230 ััะฐััั + 24 ะฝะพะฒัั)

### 7. ะะฑะฝะพะฒะปะตะฝะธะต ะะพะบัะผะตะฝัะฐัะธะธ

#### README.md
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะบะพะผะฐะฝะดะฐ `/analytics` ะฒ ัะฟะธัะพะบ ะดะพัััะฟะฝัั ะบะพะผะฐะฝะด
- โ ะะพะฑะฐะฒะปะตะฝ ัะฐะทะดะตะป "ะะพะผะฐะฝะดะฐ /analytics" ั ะพะฟะธัะฐะฝะธะตะผ ะธ ะฟัะธะผะตัะพะผ
- โ ะะฑะฝะพะฒะปัะฝ ัะฐะทะดะตะป ะผะพะฝะธัะพัะธะฝะณะฐ ั ะธะฝัะพัะผะฐัะธะตะน ะพ ะฑะธะทะฝะตั-ะผะตััะธะบะฐั
- โ ะะพะฑะฐะฒะปะตะฝะพ ะพะฟะธัะฐะฝะธะต ะดะฒัั ะดะฐัะฑะพัะดะพะฒ Grafana
- โ ะะฟะธัะฐะฝั ะผะตััะธะบะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

## ๐ ะััะธัะตะบัััะฐ ะะฝะฐะปะธัะธะบะธ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     Bot Application                         โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโ  โ
โ  โ  Handlers    โโโโโถโ Tracking     โโโโถโ Metrics      โ  โ
โ  โ  (/start,    โ    โ Functions    โ   โ Counter      โ  โ
โ  โ   /stats,    โ    โ - track_cmd  โ   โ (in-memory)  โ  โ
โ  โ   /analytics)โ    โ - track_int  โ   โ              โ  โ
โ  โโโโโโโโโโโโโโโโ    โ - track_prof โ   โโโโโโโโฌโโโโโโโโ  โ
โ                       โโโโโโโโโโโโโโโโ          โ          โ
โ                                                 โ          โ
โ  โโโโโโโโโโโโโโโโ                              โ          โ
โ  โ /analytics   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ
โ  โ  Command     โ                                          โ
โ  โโโโโโโโฌโโโโโโโโ                                          โ
โ         โ                                                  โ
โโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ
          โ
          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Analytics Module                         โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ         โ
โ  โ AnalyticsCollectorโโโโโโโโโโ   PostgreSQL     โ         โ
โ  โ                   โ         โ   Database       โ         โ
โ  โ - Overall metrics โ         โ  - profiles      โ         โ
โ  โ - User analytics  โ         โ  - interactions  โ         โ
โ  โ - Match quality   โ         โ  - matches       โ         โ
โ  โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโ         โ
โ                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ
          โ
          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Monitoring & Visualization                  โ
โ                                                               โ
โ  โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ โ
โ  โ Prometheus  โโโโโโโถโ   Grafana   โโโโโโโถโ Dashboards  โ โ
โ  โ  (planned)  โ      โ             โ      โ - Overview  โ โ
โ  โ             โ      โ             โ      โ - Business  โ โ
โ  โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฏ ะกะพะฑะธัะฐะตะผัะต ะะตััะธะบะธ

### Real-time ะผะตััะธะบะธ (in-memory)

**ะะพะผะฐะฝะดั ะฑะพัะฐ:**
- `command_start` - ะทะฐะฟััะบะธ ะฑะพัะฐ
- `command_cancel` - ะพัะผะตะฝั ะพะฟะตัะฐัะธะน
- `command_debug` - ะฒัะทะพะฒั ะพัะปะฐะดะบะธ
- `command_matches` - ะฟัะพัะผะพัั ะผะฐััะตะน
- `command_stats` - ะฟัะพัะผะพัั ััะฐัะธััะธะบะธ
- `command_analytics` - ะฟัะพัะผะพัั ะฐะฝะฐะปะธัะธะบะธ
- `commands_total` - ะฒัะตะณะพ ะบะพะผะฐะฝะด

**ะะทะฐะธะผะพะดะตะนััะฒะธั:**
- `interaction_like` - ะพัะฟัะฐะฒะปะตะฝะฝัะต ะปะฐะนะบะธ
- `interaction_dislike` - ะพัะฟัะฐะฒะปะตะฝะฝัะต ะดะธะทะปะฐะนะบะธ
- `interaction_match` - ัะพะทะดะฐะฝะฝัะต ะผะฐััะธ
- `interactions_total` - ะฒัะตะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน

**ะัะพัะธะปะธ:**
- `profile_create` - ัะพะทะดะฐะฝะฝัะต ะฟัะพัะธะปะธ
- `profile_update` - ะพะฑะฝะพะฒะปะตะฝะธั ะฟัะพัะธะปะตะน
- `profile_delete` - ัะดะฐะปะตะฝะธั ะฟัะพัะธะปะตะน
- `profiles_total` - ะฒัะตะณะพ ะดะตะนััะฒะธะน

**ะกะธััะตะผะฝัะต:**
- `uptime_seconds` - ะฒัะตะผั ัะฐะฑะพัั
- `start_time` - ะฒัะตะผั ััะฐััะฐ

### Database ะผะตััะธะบะธ

**ะะพะปัะทะพะฒะฐัะตะปะธ:**
- ะะฑัะตะต ะบะพะปะธัะตััะฒะพ
- ะกัะตะดะฝะธะน ะฒะพะทัะฐัั
- ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะฟะพะปั
- ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะปะพะบะฐัะธัะผ
- ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ัะตะปัะผ

**ะะทะฐะธะผะพะดะตะนััะฒะธั:**
- ะะฑัะตะต ะบะพะปะธัะตััะฒะพ
- ะะพะปะธัะตััะฒะพ ะปะฐะนะบะพะฒ
- ะะพะปะธัะตััะฒะพ ะดะธะทะปะฐะนะบะพะฒ
- ะะพะปะธัะตััะฒะพ ะผะฐััะตะน
- Match rate (%)

**ะะฐัะตััะฒะพ:**
- Engagement rate (%)
- Mutual like rate (%)
- ะะบัะธะฒะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ

**ะะตััะพะฝะฐะปัะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ:**
- ะกัะฐัะธััะธะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- Popularity score
- Success rate

## ๐ ะัะธะผะตัั ะัะฟะพะปัะทะพะฒะฐะฝะธั

### 1. ะะพะปััะตะฝะธะต ัะธััะตะผะฝะพะน ะฐะฝะฐะปะธัะธะบะธ

```python
from bot.analytics import AnalyticsCollector
from sqlalchemy.ext.asyncio import async_sessionmaker

# ะกะพะทะดะฐัั ะบะพะปะปะตะบัะพั
collector = AnalyticsCollector(session_factory)

# ะะพะปััะธัั ะผะตััะธะบะธ
metrics = await collector.get_overall_metrics()

print(f"ะัะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน: {metrics.total_users}")
print(f"Match rate: {metrics.match_rate:.1f}%")
print(f"Engagement: {metrics.engagement_rate:.1f}%")
```

### 2. ะะฝะฐะปะธัะธะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั

```python
# ะะพะปััะธัั ะฟะตััะพะฝะฐะปัะฝัั ะฐะฝะฐะปะธัะธะบั
user_analytics = await collector.get_user_analytics(user_id=123)

print(f"ะะผั: {user_analytics['profile']['name']}")
print(f"ะะฐััะตะน: {user_analytics['interactions']['matches']}")
print(f"Success rate: {user_analytics['interactions']['match_rate']:.1f}%")
print(f"ะะพะฟัะปััะฝะพััั: {user_analytics['popularity_score']:.1f}")
```

### 3. ะััะปะตะถะธะฒะฐะฝะธะต ัะพะฑััะธะน

```python
from bot.analytics import track_command, track_interaction, track_profile_action

# ะ ะพะฑัะฐะฑะพััะธะบะต ะบะพะผะฐะฝะดั
@router.message(Command("start"))
async def start_handler(message: Message):
    track_command("start")
    # ... ะพะฑัะฐะฑะพัะบะฐ ะบะพะผะฐะฝะดั

# ะัะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธะธ
async def handle_like(from_user: int, to_user: int):
    await interaction_repo.create(from_user, to_user, "like")
    track_interaction("like")

# ะัะธ ัะพะทะดะฐะฝะธะธ ะฟัะพัะธะปั
async def create_profile(profile: Profile):
    await repo.upsert(profile)
    track_profile_action("create")
```

### 4. ะะพะปััะตะฝะธะต real-time ะผะตััะธะบ

```python
from bot.analytics import get_metrics_counter

counter = get_metrics_counter()
metrics = counter.get_metrics()

print(f"Uptime: {metrics['uptime_seconds'] / 3600:.1f} ัะฐัะพะฒ")
print(f"ะะพะผะฐะฝะด ะฒัะฟะพะปะฝะตะฝะพ: {metrics['counters'].get('commands_total', 0)}")
print(f"ะะทะฐะธะผะพะดะตะนััะฒะธะน: {metrics['counters'].get('interactions_total', 0)}")
```

## ๐ ะัะตะธะผััะตััะฒะฐ

### 1. Visibility
- **Real-time ะผะพะฝะธัะพัะธะฝะณ**: ะะธะดะธะผะพััั ะฒัะตั ะดะตะนััะฒะธะน ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- **ะกะธััะตะผะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ**: ะะพะปะฝะฐั ะบะฐััะธะฝะฐ ัะพััะพัะฝะธั ะฟัะธะปะพะถะตะฝะธั
- **ะะตััะพะฝะฐะปัะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ**: ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะฟะพ ะบะฐะถะดะพะผั ะฟะพะปัะทะพะฒะฐัะตะปั

### 2. Data-Driven ัะตัะตะฝะธั
- **Match rate**: ะัะตะฝะบะฐ ัััะตะบัะธะฒะฝะพััะธ ะฐะปะณะพัะธัะผะฐ ะฟะพะดะฑะพัะฐ
- **Engagement rate**: ะะพะฝะธะผะฐะฝะธะต ะฒะพะฒะปะตััะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- **ะะพะฟัะปััะฝัะต ะปะพะบะฐัะธะธ**: ะคะพะบัั ะฝะฐ ัะตะณะธะพะฝั ั ะฒััะพะบะพะน ะฐะบัะธะฒะฝะพัััั
- **ะฆะตะปะธ ะทะฝะฐะบะพะผััะฒะฐ**: ะะดะฐะฟัะฐัะธั ััะฝะบัะธะน ะฟะพะด ะฟะพััะตะฑะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน

### 3. Performance Monitoring
- **Uptime tracking**: ะะพะฝััะพะปั ะดะพัััะฟะฝะพััะธ ัะตัะฒะธัะฐ
- **Command frequency**: ะะพะฝะธะผะฐะฝะธะต ะฝะฐะณััะทะบะธ ะฝะฐ ัะธััะตะผั
- **Database queries**: ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะทะฐะฟัะพัั ะดะปั ะฐะฝะฐะปะธัะธะบะธ

### 4. Extensibility
- **ะะพะดัะปัะฝะฐั ะฐััะธัะตะบัััะฐ**: ะะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ะผะตััะธะบะธ
- **ะะธะฑะบะธะต ะทะฐะฟัะพัั**: SQL-based ะฐะฝะฐะปะธัะธะบะฐ ะดะปั ะปัะฑัั ะฝัะถะด
- **Integration ready**: ะะพัะพะฒะพ ะบ ะธะฝัะตะณัะฐัะธะธ ั Prometheus/Grafana

### 5. Testing
- **100% ะฟะพะบัััะธะต**: ะัะต ััะฝะบัะธะธ ะฐะฝะฐะปะธัะธะบะธ ะฟะพะบัััั ัะตััะฐะผะธ
- **Edge cases**: ะะฑัะฐะฑะพัะบะฐ ะฟัััะพะน ะะ ะธ ะพััััััะฒัััะธั ะดะฐะฝะฝัั
- **Async support**: ะะพะปะฝะพัััั ะฐัะธะฝััะพะฝะฝะฐั ะฐััะธัะตะบัััะฐ

## ๐ฎ ะกะปะตะดัััะธะต ะจะฐะณะธ (ะดะปั ะฑัะดััะธั ัะฟัะธะฝัะพะฒ)

### 1. Prometheus Integration
- ะะพะฑะฐะฒะธัั Prometheus exporter endpoint
- ะญะบัะฟะพััะธัะพะฒะฐัั ะผะตััะธะบะธ ะธะท MetricsCounter
- ะะฐัััะพะธัั scraping ะฒ prometheus.yml

### 2. Advanced Analytics
- ะัะตะผะตะฝะฝัะต ััะดั (daily/weekly/monthly trends)
- Cohort analysis (ะบะพะณะพััั ะฟะพะปัะทะพะฒะฐัะตะปะตะน)
- Funnel analysis (ะบะพะฝะฒะตััะธะพะฝะฝัะต ะฒะพัะพะฝะบะธ)
- A/B ัะตััะธัะพะฒะฐะฝะธะต ะผะตััะธะบ

### 3. Alerting
- ะะปะตััั ะฝะฐ ะบัะธัะธัะตัะบะธะต ะผะตััะธะบะธ
- ะฃะฒะตะดะพะผะปะตะฝะธั ะฒ Telegram/Slack
- ะะฒัะพะผะฐัะธัะตัะบะฐั ััะบะฐะปะฐัะธั ะฟัะพะฑะปะตะผ

### 4. Popular Interests
- ะะตะฐะปะธะทะพะฒะฐัั ะฟะพะดัััั ะฟะพะฟัะปััะฝัั ะธะฝัะตัะตัะพะฒ
- ะัะฟะพะปัะทะพะฒะฐัั PostgreSQL JSONB unnest
- ะะพะฑะฐะฒะธัั ะฒ ะดะฐัะฑะพัะด

### 5. Machine Learning
- ะัะตะดัะบะฐะทะฐะฝะธะต ััะฟะตัะฝะพััะธ ะผะฐััะฐ
- ะะตะบะพะผะตะฝะดะฐัะตะปัะฝัะต ัะธััะตะผั
- Anomaly detection

## ๐ ะัะพะณะธ

### ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ
โ ะะพะดัะปั ะฐะฝะฐะปะธัะธะบะธ (`bot/analytics.py`)
โ ะะฝััััะผะตะฝัะฐัะธั ะบะพะดะฐ (tracking ะฒ handlers)
โ ะะพะผะฐะฝะดะฐ `/analytics` ะดะปั ะฟัะพัะผะพััะฐ ะผะตััะธะบ
โ Business metrics dashboard ะดะปั Grafana
โ 24 comprehensive tests
โ ะะพะบัะผะตะฝัะฐัะธั (README.md)
โ ะัะต 254 ัะตััะฐ ะฟัะพัะพะดัั

### ะะตััะธะบะธ
- **ะะพะฒัะน ะบะพะด**: ~480 ัััะพะบ (analytics.py)
- **ะะฑะฝะพะฒะปัะฝะฝัะน ะบะพะด**: ~50 ัััะพะบ (main.py)
- **ะขะตััั**: 24 ะฝะพะฒัั ัะตััะฐ
- **ะะฐัะฑะพัะดั**: 1 ะฝะพะฒัะน Grafana dashboard
- **ะะพะบัะผะตะฝัะฐัะธั**: ะะฑะฝะพะฒะปัะฝ README.md

### ะะฐัะตััะฒะพ
- โ ะัะต ัะตััั ะฟัะพัะพะดัั (254/254)
- โ ะะพะปะฝะพะต ะฟะพะบัััะธะต ัะตััะฐะผะธ ะฝะพะฒะพะณะพ ััะฝะบัะธะพะฝะฐะปะฐ
- โ ะกะพะพัะฒะตัััะฒะธะต ััะธะปั ะบะพะดะฐ ะฟัะพะตะบัะฐ
- โ ะัะธะฝััะพะฝะฝะฐั ะฐััะธัะตะบัััะฐ
- โ Type hints ะฒะตะทะดะต
- โ ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

## ๐ ะัะฒะพะดั

ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะฟะพะปะฝะพัะตะฝะฝะฐั ัะธััะตะผะฐ ะฐะฝะฐะปะธัะธะบะธ, ะบะพัะพัะฐั:
1. **ะกะพะฑะธัะฐะตั ะผะตััะธะบะธ** ะธะท ะฒัะตั ะบะปััะตะฒัั ัะพัะตะบ ะฟัะธะปะพะถะตะฝะธั
2. **ะะณัะตะณะธััะตั ะดะฐะฝะฝัะต** ะธะท ะฑะฐะทั ะดะฐะฝะฝัั ะฒ ัะดะพะฑะฝะพะผ ัะพัะผะฐัะต
3. **ะัะตะดะพััะฐะฒะปัะตั API** ะดะปั ะฟะพะปััะตะฝะธั ะผะตััะธะบ ัะตัะตะท ะบะพะผะฐะฝะดั ะฑะพัะฐ
4. **ะะธะทัะฐะปะธะทะธััะตั ะดะฐะฝะฝัะต** ัะตัะตะท Grafana dashboards
5. **ะะฐัััะฐะฑะธััะตััั** ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒัั ะผะตััะธะบ

ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ production ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะธ ะดะฐะปัะฝะตะนัะตะผั ัะฐััะธัะตะฝะธั.
