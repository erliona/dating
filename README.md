# Dating Bot & WebApp

Набор инструментов для запуска Telegram-бота знакомств с мини-приложением. Репозиторий
содержит Python-пакет `bot` и статическую веб-часть для WebApp.

## Возможности

- Telegram-бот на базе `aiogram` с опросом /start.
- Хранение анкет в PostgreSQL с ORM (SQLAlchemy) и миграциями (Alembic).
- Расширенные профили: геолокация, интересы, цели знакомства и фото (файл или ссылка).
- Интеграция мини-приложения: кнопка в боте открывает WebApp, который отправляет
  анкету обратно боту.
- WebApp с клиентской валидацией, подсказками по заполнению, прогресс-баром и
  автосохранением черновика анкеты.

## Требования

- Python 3.11+
- `pip` и `virtualenv` / `venv`
- PostgreSQL 13+ (или совместимый сервис)
- Аккаунт Telegram для регистрации бота через [@BotFather](https://t.me/BotFather)
- Веб-сервер или хостинг для раздачи содержимого каталога `webapp/`

## Установка зависимостей

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install --upgrade pip
pip install -r requirements.txt
```

## Конфигурация

Бот использует переменные окружения. Создайте файл `.env` или настройте окружение
в процессе деплоя:

- `BOT_TOKEN` — токен, полученный у BotFather (обязательный).
- `BOT_DATABASE_URL` — строка подключения к PostgreSQL (например,
  `postgresql+asyncpg://user:pass@host:5432/dating`). Поддерживается также
  переменная `DATABASE_URL`.
- `WEBAPP_URL` — публичный URL, где будет доступен миниапп (например,
  `https://example.com/webapp/index.html`).

Пример запуска с переменными окружения:

```bash
export BOT_TOKEN="1234567890:ABC..."
export BOT_DATABASE_URL="postgresql+asyncpg://user:pass@localhost:5432/dating"
export WEBAPP_URL="https://example.com/webapp/index.html"
```

## Миграции базы данных

Перед запуском бота примените миграции Alembic:

```bash
alembic upgrade head
```

Команда использует переменную окружения `BOT_DATABASE_URL` (или `DATABASE_URL`).

## Запуск локально

1. Активируйте виртуальное окружение и установите зависимости.
2. Задайте переменные окружения.
3. Выполните команду:

   ```bash
   python -m bot.main
   ```

Бот запустится в режиме long polling. В Telegram отправьте `/start` своему боту,
чтобы пройти анкету. Можно заполнить её вручную или через кнопку мини-приложения.

## Мини-приложение

Содержимое каталога `webapp/` — статический HTML/JS. Его можно раздавать с любого
веб-сервера (Nginx, GitHub Pages, Firebase Hosting и т.д.). После деплоя укажите URL
в переменной `WEBAPP_URL`, чтобы кнопка в боте открывала миниапп.

WebApp уже включает интерактивную валидацию, подсказки, прогресс-бар заполнения
и автосохранение черновика анкеты в `localStorage`. Дополнительно можно
расширить мини-приложение загрузкой фотографий или связью с backend.

## Деплой

- **Бот**. Популярные варианты — Docker-контейнер на VPS, Railway.app, Render.com
  или любой сервер с поддержкой Python. Главное — настроить переменные окружения
  и процесс мониторинга (systemd, supervisor, Docker restart policy).
- **WebApp**. Разместите статические файлы в выбранном CDN/хостинге и убедитесь,
  что URL доступен по HTTPS.

## Структура репозитория

```
.
├── alembic.ini
├── bot/
│   ├── __init__.py
│   ├── config.py
│   ├── db.py
│   └── main.py
├── migrations/
│   ├── env.py
│   └── versions/
│       └── 20240611_0001_create_profiles_table.py
├── requirements.txt
├── webapp/
│   ├── css/
│   │   └── style.css
│   ├── js/
│   │   └── app.js
│   └── index.html
└── README.md
```

## Полезные команды

```bash
python -m bot.main       # запуск бота
pre-commit run --all-files  # если добавите pre-commit хуки
```

Готово! Дополняйте проект по своим требованиям: подключайте БД, добавляйте
аналитику, интегрируйте платёжные сервисы.


## Бэклог развития

Подробная дорожная карта и идеи по развитию вынесены в отдельный файл
[`BACKLOG.md`](./BACKLOG.md). Там собраны инициативы по функциональности,
бизнес-логике, UI/UX и инфраструктуре, распределённые по спринтам.
