# Dating Bot & WebApp

Набор инструментов для запуска Telegram-бота знакомств с мини-приложением. Репозиторий
содержит Python-пакет `bot` и статическую веб-часть для WebApp.

## Возможности

- Telegram-бот на базе `aiogram` с опросом /start.
- Хранение анкет в JSON-файле и простая логика взаимного подбора.
- Интеграция мини-приложения: кнопка в боте открывает WebApp, который отправляет
  анкету обратно боту.

## Требования

- Python 3.11+
- `pip` и `virtualenv` / `venv`
- Аккаунт Telegram для регистрации бота через [@BotFather](https://t.me/BotFather)
- Веб-сервер или хостинг для раздачи содержимого каталога `webapp/`

## Установка зависимостей

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install --upgrade pip
pip install aiogram~=3.3
```

## Конфигурация

Бот использует переменные окружения. Создайте файл `.env` или настройте окружение
в процессе деплоя:

- `BOT_TOKEN` — токен, полученный у BotFather (обязательный).
- `WEBAPP_URL` — публичный URL, где будет доступен миниапп (например,
  `https://example.com/webapp/index.html`).
- `BOT_STORAGE_PATH` — путь до файла для сохранения анкет. По умолчанию данные
  хранятся только в оперативной памяти.

Пример запуска с переменными окружения:

```bash
export BOT_TOKEN="1234567890:ABC..."
export WEBAPP_URL="https://example.com/webapp/index.html"
export BOT_STORAGE_PATH="data/profiles.json"
```

## Запуск локально

1. Активируйте виртуальное окружение и установите зависимости.
2. Задайте переменные окружения.
3. Выполните команду:

   ```bash
   python -m bot.main
   ```

Бот запустится в режиме long polling. В Telegram отправьте `/start` своему боту,
чтобы пройти анкету. Можно заполнить её вручную или через кнопку мини-приложения.

## Мини-приложение

Содержимое каталога `webapp/` — статический HTML/JS. Его можно раздавать с любого
веб-сервера (Nginx, GitHub Pages, Firebase Hosting и т.д.). После деплоя укажите URL
в переменной `WEBAPP_URL`, чтобы кнопка в боте открывала миниапп.

При желании WebApp можно расширить: добавить валидацию, загрузку фотографий или
связь с backend.

## Деплой

- **Бот**. Популярные варианты — Docker-контейнер на VPS, Railway.app, Render.com
  или любой сервер с поддержкой Python. Главное — настроить переменные окружения
  и процесс мониторинга (systemd, supervisor, Docker restart policy).
- **WebApp**. Разместите статические файлы в выбранном CDN/хостинге и убедитесь,
  что URL доступен по HTTPS.

## Структура репозитория

```
.
├── bot/
│   ├── __init__.py
│   ├── config.py
│   └── main.py
├── webapp/
│   ├── css/
│   │   └── style.css
│   ├── js/
│   │   └── app.js
│   └── index.html
└── README.md
```

## Полезные команды

```bash
python -m bot.main       # запуск бота
pre-commit run --all-files  # если добавите pre-commit хуки
```

Готово! Дополняйте проект по своим требованиям: подключайте БД, добавляйте
аналитику, интегрируйте платёжные сервисы.

## Дальнейшие шаги по развитию проекта

Ниже собраны идеи, которые помогут превратить базовую демонстрацию в
производственный сервис. Предложения разбиты по блокам, чтобы можно было
планировать развитие итерациями.

### Бэкенд и бот

- **Перейти на постоянное хранилище.** Вместо JSON-файла подключить БД
  (PostgreSQL, SQLite для локальной отладки, Redis для кеширования). Это
  позволит хранить историю анкет, метаданные, статусы, а также масштабировать
  сервис горизонтально.
- **Расширить модель профиля.** Добавить поля с геолокацией, интересами,
  ссылками на соцсети, а также поддержать загрузку фото и верификацию
  изображений. Для работы с медиа понадобится логика скачивания файлов из
  Telegram и хранение их в CDN или S3-совместимом хранилище.
- **Улучшить подбор.** Заменить перебор на систему рекомендаций: учесть
  географическую близость, схожесть интересов, активность пользователей,
  реализовать ограничение по возрастному диапазону, систему весов и фильтров.
- **Планировщик уведомлений.** Добавить фоновую задачу, которая будет напоминать
  пользователям о новых совпадениях, напоминать завершить анкету или
  возвращать неактивных участников. Можно использовать `asyncio.create_task`,
  Celery или APScheduler.
- **Модерация и безопасность.** Ввести механизмы блокировок, жалоб, антиспам
  фильтры, ограничение по количеству сообщений. Стоит продумать хранение логов
  и аудит действий администраторов.
- **Локализация.** Вынести пользовательские тексты в отдельный слой и добавить
  поддержку нескольких языков через `gettext` или словари.

### WebApp

- **Валидация и UX.** Добавить клиентские проверки (минимальная/максимальная
  длина, подсказки по заполнению, индикаторы прогресса), а также обработку
  ошибок от бота с отображением понятных сообщений.
- **Динамический контент.** Реализовать загрузку текущей анкеты пользователя и
  возможность редактировать её. Для этого понадобится простое API у бота или
  отдельный backend.
- **Работа с медиа.** Поддержать загрузку фотографий, предпросмотр, кадрирование
  и отправку файла через метод `tg.sendData` или загрузку на сторонний сервер.
- **Аналитика WebApp.** Встроить отслеживание метрик (Telegram Statistics,
  собственные события) для понимания воронки конверсии.

### Инфраструктура и DevOps

- **Контейнеризация.** Описать Dockerfile и docker-compose для локального
  запуска и деплоя. Это упростит масштабирование и публикацию на PaaS.
- **CI/CD.** Настроить тесты и проверки (lint, type-check, unit-тесты) в GitHub
  Actions. Добавить автоматическую выкладку после прохождения проверок.
- **Мониторинг и алертинг.** Подключить Sentry или аналог для отслеживания
  ошибок, а также Prometheus/Grafana либо готовые сервисы для мониторинга
  производительности.
- **Документация.** Описать архитектуру, сценарии пользовательских историй,
  внутренние API, инструкции по модерации и поддержке пользователей.

### Бизнес-функциональность

- **Платёжная модель.** Ввести монетизацию: премиум-подписки, бусты, платные
  сообщения или подарки. Telegram поддерживает платежи через встроенные
  провайдеры и `Stars`.
- **Социальные механики.** Добавить игры, совместимые события, рекомендации
  «кого лайкнуть», ежедневные подборки, подбор друзей по интересам.
- **Вовлекающие сценарии.** Настроить воронку онбординга, геймификацию,
  бейджи и систему достижений для повышения удержания.

Для каждой инициативы стоит завести задачи в бэклоге, определить ожидаемый
результат, метрики успеха и ресурсы на реализацию. Такой план поможет
управлять развитием продукта и приоритизировать работы.
