# Database and Admin Scripts

Этот набор скриптов предназначен для работы с базой данных и администрированием системы.

## Доступные скрипты

### 1. `backup_database.sh` - Резервное копирование БД

Создает полный бэкап базы данных PostgreSQL:

```bash
# Создать бэкап
./scripts/backup_database.sh

# Создать бэкап с указанием имени файла
./scripts/backup_database.sh my_backup.sql
```

**Что делает:**
- Подключается к PostgreSQL
- Создает полный дамп базы данных
- Сохраняет в файл с временной меткой
- Сжимает архив для экономии места

### 2. `restore_database.sh` - Восстановление БД

Восстанавливает базу данных из бэкапа:

```bash
# Восстановить из последнего бэкапа
./scripts/restore_database.sh

# Восстановить из конкретного файла
./scripts/restore_database.sh backup_2024-10-23.sql
```

**Что делает:**
- Останавливает приложение
- Очищает текущую БД
- Восстанавливает данные из бэкапа
- Запускает приложение

### 3. `create_admin.py` - Создание администратора

Создает нового администратора в системе:

```bash
# Создать админа интерактивно
python scripts/create_admin.py

# Создать админа с параметрами
python scripts/create_admin.py --username admin --password secure123 --email admin@example.com
```

**Что делает:**
- Создает нового пользователя в БД
- Хеширует пароль с bcrypt
- Назначает права администратора
- Выводит информацию о созданном пользователе

## Использование

### Резервное копирование

```bash
# Ежедневный бэкап
./scripts/backup_database.sh

# Проверить созданные бэкапы
ls -la backups/
```

### Восстановление

```bash
# Восстановить из бэкапа
./scripts/restore_database.sh backup_2024-10-23.sql

# Проверить статус после восстановления
docker compose ps
```

### Создание админа

```bash
# Интерактивное создание
python scripts/create_admin.py

# Автоматическое создание
python scripts/create_admin.py --username admin --password admin123
```

## Безопасность

- Все пароли хешируются с bcrypt
- Бэкапы содержат только данные, без паролей
- Скрипты требуют правильных переменных окружения
- Восстановление требует подтверждения

## Переменные окружения

Скрипты используют следующие переменные:

- `POSTGRES_DB` - имя базы данных
- `POSTGRES_USER` - пользователь БД
- `POSTGRES_PASSWORD` - пароль БД
- `POSTGRES_HOST` - хост БД (по умолчанию localhost)
- `POSTGRES_PORT` - порт БД (по умолчанию 5432)

## Примеры

### Ежедневный бэкап

```bash
# Добавить в crontab для ежедневного бэкапа в 2:00
0 2 * * * /path/to/dating/scripts/backup_database.sh
```

### Восстановление после сбоя

```bash
# 1. Остановить сервисы
docker compose down

# 2. Восстановить БД
./scripts/restore_database.sh backup_2024-10-23.sql

# 3. Запустить сервисы
docker compose up -d
```

### Создание админа для продакшна

```bash
# Создать админа с безопасным паролем
python scripts/create_admin.py --username admin --password $(openssl rand -base64 32)
```

## Устранение проблем

### Ошибка подключения к БД

1. Проверьте переменные окружения
2. Убедитесь, что PostgreSQL запущен
3. Проверьте сетевую доступность

### Ошибка восстановления

1. Проверьте права доступа к файлу бэкапа
2. Убедитесь, что БД пуста
3. Проверьте формат файла бэкапа

### Ошибка создания админа

1. Проверьте подключение к БД
2. Убедитесь, что таблица users существует
3. Проверьте уникальность username

## Преимущества

✅ **Надежность** - полные бэкапы с проверкой целостности  
✅ **Безопасность** - хеширование паролей и проверка прав  
✅ **Автоматизация** - готовые скрипты для всех операций  
✅ **Восстановление** - быстрое восстановление после сбоев  
✅ **Мониторинг** - логирование всех операций
