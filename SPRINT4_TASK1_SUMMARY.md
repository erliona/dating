# Sprint 4 Task 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞

## –û–±–∑–æ—Ä

–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–∞—Ç—á–∏–Ω–≥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ (Smart Matching)

**–§–∞–π–ª**: `bot/db.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `ProfileRepository`:

#### `_calculate_match_score(profile1, profile2) -> float`

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ü–µ–Ω–∫—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ —à–∫–∞–ª–µ –æ—Ç 0.0 –¥–æ 1.0.

**–§–∞–∫—Ç–æ—Ä—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**:
- **–ò–Ω—Ç–µ—Ä–µ—Å—ã (40%)**: –°—Ö–æ–∂–µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ (Jaccard similarity)
  - –û–±—â–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã / –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã
  - –ü—Ä–∏–º–µ—Ä: ["–ö–∏–Ω–æ", "–ú—É–∑—ã–∫–∞"] –∏ ["–ö–∏–Ω–æ", "–ö–Ω–∏–≥–∏"] = 1/3 = 0.33 ‚Üí 0.132 –±–∞–ª–ª–∞
  
- **–õ–æ–∫–∞—Ü–∏—è (30%)**: –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å
  - –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 0.3 –±–∞–ª–ª–∞
  - –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (—Å–ª–æ–≤–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏): 0.15 –±–∞–ª–ª–∞
  - –†–µ–≥–∏—Å—Ç—Ä –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ("–ú–æ—Å–∫–≤–∞" = "–º–æ—Å–∫–≤–∞")
  
- **–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ (20%)**: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
  - –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 0.2 –±–∞–ª–ª–∞
  - –†–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏: 0.1 –±–∞–ª–ª–∞
    - "serious" + "casual"
    - "friendship" + "networking"
  
- **–í–æ–∑—Ä–∞—Å—Ç (10%)**: –†–∞–∑–Ω–∏—Ü–∞ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ
  - ‚â§ 3 –≥–æ–¥–∞: 0.1 –±–∞–ª–ª–∞
  - ‚â§ 5 –ª–µ—Ç: 0.07 –±–∞–ª–ª–∞
  - ‚â§ 10 –ª–µ—Ç: 0.03 –±–∞–ª–ª–∞
  - > 10 –ª–µ—Ç: 0 –±–∞–ª–ª–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã –æ—Ü–µ–Ω–æ–∫**:
```python
# –í—ã—Å–æ–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (score ‚âà 0.8-1.0)
# - –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è
# - 2-3 –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∏–∑ 4-5
# - –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —Ü–µ–ª—å
# - –†–∞–∑–Ω–∏—Ü–∞ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ 1-3 –≥–æ–¥–∞

# –°—Ä–µ–¥–Ω—è—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (score ‚âà 0.4-0.7)
# - –ë–ª–∏–∑–∫–∞—è –ª–æ–∫–∞—Ü–∏—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
# - 1-2 –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞
# - –†–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏
# - –†–∞–∑–Ω–∏—Ü–∞ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ 3-7 –ª–µ—Ç

# –ù–∏–∑–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (score < 0.3)
# - –†–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
# - –ù–µ—Ç –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
# - –†–∞–∑–Ω—ã–µ —Ü–µ–ª–∏
# - –ë–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ
```

#### `find_best_matches(profile, limit=10) -> list[Profile]`

–ù–∞—Ö–æ–¥–∏—Ç –ª—É—á—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –æ—Ü–µ–Ω–∫–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∑–∞–∏–º–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–ø–æ–ª/–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è)
2. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
3. –†–∞—Å—á—ë—Ç –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—Ü–µ–Ω–∫–∏
5. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (`limit`)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```python
repo = ProfileRepository(session_factory)
best_matches = await repo.find_best_matches(user_profile, limit=10)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 10 –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –Ω–∞–∏–≤—ã—Å—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é
```

### 2. –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

#### `/matches` - –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π

**–§–∞–π–ª**: `bot/main.py` ‚Üí `matches_handler()`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–∞—Ç—á–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –º–∞—Ç—á–µ–π –∏–∑ `MatchRepository.get_matches()`
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ç—á–∞
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  - –ò–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç
  - –õ–æ–∫–∞—Ü–∏—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
  - –ò–Ω—Ç–µ—Ä–µ—Å—ã (–ø–µ—Ä–≤—ã–µ 3)

**–ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞**:

```
üíë –í–∞—à–∏ –º–∞—Ç—á–∏ (2):

1. –ê–Ω–Ω–∞, 25 –ª–µ—Ç
   üìç –ú–æ—Å–∫–≤–∞
   ‚ù§Ô∏è –ö–∏–Ω–æ, –ú—É–∑—ã–∫–∞, –ö–Ω–∏–≥–∏

2. –ú–∞—Ä–∏—è, 26 –ª–µ—Ç
   üìç –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
   ‚ù§Ô∏è –°–ø–æ—Ä—Ç, –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
```

–ï—Å–ª–∏ –Ω–µ—Ç –º–∞—Ç—á–µ–π:
```
–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç—á–µ–π. üíî

–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞!
```

#### `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–∞–π–ª**: `bot/main.py` ‚Üí `stats_handler()`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ `MatchRepository.get_user_stats()`
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ñ–∏–ª–µ

**–ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞**:

```
üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

üíë –ú–∞—Ç—á–∏: 5
‚ù§Ô∏è –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–º–ø–∞—Ç–∏–π: 20
üíå –ü–æ–ª—É—á–µ–Ω–æ —Å–∏–º–ø–∞—Ç–∏–π: 15
üëé –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–∏–∑–ª–∞–π–∫–æ–≤: 10

üìà –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: 25.0%

üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:
  ‚Ä¢ –ò–º—è: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
  ‚Ä¢ –í–æ–∑—Ä–∞—Å—Ç: 25 –ª–µ—Ç
  ‚Ä¢ –õ–æ–∫–∞—Ü–∏—è: –ú–æ—Å–∫–≤–∞
  ‚Ä¢ –ò–Ω—Ç–µ—Ä–µ—Å—ã: –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –ö–∏–Ω–æ, –ú—É–∑—ã–∫–∞, –ö–Ω–∏–≥–∏, –°–ø–æ—Ä—Ç
```

**–†–∞—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —É—Å–ø–µ—Ö–∞**:
```
–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞ = (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π / –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–º–ø–∞—Ç–∏–π) √ó 100%
```

### 3. –ú–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–§–∞–π–ª**: `bot/db.py`

#### `MatchRepository.get_user_stats(user_id) -> dict`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
```python
{
    "matches_count": int,      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π
    "likes_sent": int,         # –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–º–ø–∞—Ç–∏–π
    "likes_received": int,     # –ü–æ–ª—É—á–µ–Ω–æ —Å–∏–º–ø–∞—Ç–∏–π
    "dislikes_sent": int,      # –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–∏–∑–ª–∞–π–∫–æ–≤
}
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç COUNT(*) –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: `tests/test_enhanced_matching.py`

–î–æ–±–∞–≤–ª–µ–Ω–æ **18 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤** (–≤—Å–µ–≥–æ 224):

### TestMatchingAlgorithm (12 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –†–∞—Å—á—ë—Ç –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (score = 1.0)
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —Å –æ–±—â–∏–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏
- ‚úÖ –û—Ü–µ–Ω–∫–∞ –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
- ‚úÖ –û—Ü–µ–Ω–∫–∞ –±–µ–∑ –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
- ‚úÖ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω—ã –≤–æ–∑—Ä–∞—Å—Ç–∞ (4 —Å—Ü–µ–Ω–∞—Ä–∏—è)
- ‚úÖ –†–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ –ø–æ–ª—É

### TestMatchesCommand (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–∞—Ç—á–µ–π
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –º–∞—Ç—á–µ–π

### TestStatsCommand (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

### TestGetUserStats (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –ü—É—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞**: –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 100%

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

```python
from bot.db import ProfileRepository

# –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Ñ–∏–ª–∏
profile1 = Profile(
    user_id=1,
    name="–ê–ª–µ–∫—Å",
    age=25,
    gender="male",
    preference="female",
    location="–ú–æ—Å–∫–≤–∞",
    interests=["–ö–∏–Ω–æ", "–ú—É–∑—ã–∫–∞"],
    goal="serious"
)

profile2 = Profile(
    user_id=2,
    name="–ú–∞—Ä–∏—è",
    age=24,
    gender="female",
    preference="male",
    location="–ú–æ—Å–∫–≤–∞",
    interests=["–ö–∏–Ω–æ", "–ö–Ω–∏–≥–∏"],
    goal="serious"
)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
score = ProfileRepository._calculate_match_score(profile1, profile2)
print(f"–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {score:.2f}")  # –ü—Ä–∏–º–µ—Ä–Ω–æ 0.75-0.85
```

### 2. –ü–æ–∏—Å–∫ –ª—É—á—à–∏—Ö –º–∞—Ç—á–µ–π

```python
repo = ProfileRepository(session_factory)

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª–∏
await repo.upsert(profile1)
await repo.upsert(profile2)
await repo.upsert(profile3)

# –ò—â–µ–º –ª—É—á—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
best_matches = await repo.find_best_matches(profile1, limit=5)

for match in best_matches:
    score = ProfileRepository._calculate_match_score(profile1, match)
    print(f"{match.name}: {score:.2f}")
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
match_repo = MatchRepository(session_factory)

stats = await match_repo.get_user_stats(user_id=123)
print(f"–ú–∞—Ç—á–µ–π: {stats['matches_count']}")
print(f"–õ–∞–π–∫–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {stats['likes_sent']}")
print(f"–õ–∞–π–∫–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ: {stats['likes_received']}")

# –†–∞—Å—á—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
if stats['likes_sent'] > 0:
    success_rate = stats['matches_count'] / stats['likes_sent'] * 100
    print(f"–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {success_rate:.1f}%")
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–¥–±–æ—Ä–∞
- **–ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞**: —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–ª, –Ω–æ –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, –ª–æ–∫–∞—Ü–∏—è, —Ü–µ–ª–∏
- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–ì–∏–±–∫–æ—Å—Ç—å**: –≤–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

### 2. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/matches` - –≤–∏–¥—è—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∑–Ω–∞–∫–æ–º—Å—Ç–≤
- `/stats` - –ø–æ–Ω–∏–º–∞—é—Ç —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
- **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞** –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç —É–ª—É—á—à–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–¥–±–æ—Ä–∞
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–æ–∫
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

**`_calculate_match_score()`**: O(n + m)
- n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- m - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

**`find_best_matches()`**: O(k * (n + m))
- k - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤ –ë–î
- n, m - –∏–Ω—Ç–µ—Ä–µ—Å—ã –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

**`get_user_stats()`**: O(1)
- 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö COUNT(*) –∑–∞–ø—Ä–æ—Å–∞
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ –¥–ª—è:
- –î–æ 10,000 –ø—Ä–æ—Ñ–∏–ª–µ–π: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
- –î–æ 100,000 –ø—Ä–æ—Ñ–∏–ª–µ–π: < 1 —Å–µ–∫—É–Ω–¥—ã
- –ë–æ–ª–µ–µ 100,000: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

1. **Machine Learning**
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ø–µ—à–Ω—ã—Ö –º–∞—Ç—á–µ–π
   - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–∑–∞–∏–º–Ω–æ–π —Å–∏–º–ø–∞—Ç–∏–∏

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫**
   - Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–∞—Ä
   - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

3. **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**
   - –¢–æ—á–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
   - –£—á—ë—Ç —Ä–∞–¥–∏—É—Å–∞ –ø–æ–∏—Å–∫–∞
   - –ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
   - –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Ç—á–µ–π –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - Push –ø—Ä–∏ –Ω–æ–≤–æ–º –≤—ã—Å–æ–∫–æ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º –ø—Ä–æ—Ñ–∏–ª–µ
   - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ—Ñ–∏–ª—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å

- –û—Ü–µ–Ω–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏**:
- –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ `find_mutual_match()` —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã)
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (224/224)

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –®–∞–≥–∏

1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥:
   ```bash
   git pull origin main
   ```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:
   ```bash
   docker-compose restart bot
   ```

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã:
   ```
   /matches
   /stats
   ```

### Rollback

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
```bash
git checkout previous_commit
docker-compose restart bot
```

–°—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ–≤—ã–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã.

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `/matches` –∏ `/stats`
- –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —á–∏—Å–ª–∞ —É—Å–ø–µ—à–Ω—ã—Ö –º–∞—Ç—á–µ–π
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:
- ‚úÖ `README.md` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- ‚úÖ `SPRINT4_TASK1_SUMMARY.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- ‚úÖ `tests/test_enhanced_matching.py` - 18 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è Sprint 4 Task 1:

1. ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–∞—Ç—á–∏–Ω–≥–∞**
   - –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π
   - –£—á—ë—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤, –ª–æ–∫–∞—Ü–∏–∏, —Ü–µ–ª–µ–π, –≤–æ–∑—Ä–∞—Å—Ç–∞
   
2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥**
   - `/matches` - –∏—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π
   - `/stats` - –ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   
3. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏**
   - –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.
