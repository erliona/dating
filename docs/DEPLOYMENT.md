# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Dating Bot –≤ production.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ CI/CD (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π-–¥–µ–ø–ª–æ–π-—á–µ—Ä–µ–∑-cicd)
- [–†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä—É—á–Ω–æ–µ-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ CI/CD

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è production. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ**:
- Ubuntu 20.04+ / Debian 11+ / CentOS 8+
- SSH –¥–æ—Å—Ç—É–ø —Å sudo –ø—Ä–∞–≤–∞–º–∏
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: 22 (SSH), 80 (HTTP), 443 (HTTPS)
- –ú–∏–Ω–∏–º—É–º 2GB RAM, 20GB disk space
- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–í GitHub**:
- –§–æ—Ä–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –î–æ—Å—Ç—É–ø –∫ Settings (–¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Secrets)

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ SSH –∫–ª—é—á–∞

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ —Å–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á –¥–ª—è –¥–µ–ø–ª–æ—è:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á (–µ—Å–ª–∏ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "deploy@dating-bot" -f ~/.ssh/dating_deploy

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/dating_deploy.pub user@your-server.com

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø
ssh -i ~/.ssh/dating_deploy user@your-server.com
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub:
**Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret**

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `DEPLOY_HOST` | IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ | `123.45.67.89` –∏–ª–∏ `server.example.com` |
| `DEPLOY_USER` | SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å sudo | `ubuntu` –∏–ª–∏ `root` |
| `DEPLOY_SSH_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/dating_deploy` |
| `BOT_TOKEN` | Telegram bot token | `123456789:ABCdef...` –æ—Ç @BotFather |

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å DEPLOY_SSH_KEY**:
```bash
# Linux/Mac
cat ~/.ssh/dating_deploy | pbcopy  # –∫–æ–ø–∏—Ä—É–µ—Ç –≤ –±—É—Ñ–µ—Ä

# –ò–ª–∏ –≤—ã–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å
cat ~/.ssh/dating_deploy
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** –≤—ã–≤–æ–¥, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–æ–∫–∏ `-----BEGIN ... KEY-----` –∏ `-----END ... KEY-----`.

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (–¥–ª—è HTTPS):

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|--------|----------|--------------|
| `DOMAIN` | –í–∞—à –¥–æ–º–µ–Ω –¥–ª—è HTTPS | `localhost` |
| `ACME_EMAIL` | Email –¥–ª—è Let's Encrypt | `admin@example.com` |
| `POSTGRES_DB` | –ò–º—è –ë–î | `dating` |
| `POSTGRES_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | `dating` |
| `POSTGRES_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: `DOMAIN` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. DNS –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä.

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS (–¥–ª—è HTTPS)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–º–µ–Ω, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ A-–∑–∞–ø–∏—Å—å:

```
–¢–∏–ø: A
–ò–º—è: dating (–∏–ª–∏ @)
–ó–Ω–∞—á–µ–Ω–∏–µ: <IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞>
TTL: 300
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS:
```bash
dig +short dating.example.com
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π** (–ø—Ä–∏ push –≤ main):
```bash
git add .
git commit -m "Configure production deployment"
git push origin main
```

**–†—É—á–Ω–æ–π** (—á–µ—Ä–µ–∑ GitHub UI):
1. –û—Ç–∫—Ä–æ–π—Ç–µ **Actions** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow **Deploy**
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow** ‚Üí **Run workflow**

### –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –≤ GitHub Actions:
- ‚úÖ –ó–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ = —É—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π
- ‚ùå –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ = –æ—à–∏–±–∫–∞ (—Å–º. –ª–æ–≥–∏)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–∏—Å—ã**:
```bash
ssh user@your-server "cd /opt/dating && docker compose ps"
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `Up` –∏ `healthy`.

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞**:
- –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
- –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebApp**:
- –û—Ç–∫—Ä–æ–π—Ç–µ https://your-domain.com
- –î–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —Ñ–æ—Ä–º–∞ –ø—Ä–æ—Ñ–∏–ª—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- Grafana: http://your-server:3000 (admin/admin)
- Prometheus: http://your-server:9090

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ?

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
2. **SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker/Docker Compose
   - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/opt/dating`
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
4. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞** - rsync —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è .env** - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
6. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ BOT_TOKEN –∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
7. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**:
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (graceful shutdown)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ .env –∫–∞–∫ .env.previous
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –ë–î
   - –°–±–æ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
   - –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
8. **Health check** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## –†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞ CI/CD –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- Docker Engine 20.10+
- Docker Compose v2.0+
- Git

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (Ubuntu/Debian)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
cd /opt
sudo mkdir dating
sudo chown $USER:$USER dating
cd dating

git clone https://github.com/erliona/dating.git .
```

### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
nano .env
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –¥–ª—è .env:
```env
BOT_TOKEN=your-telegram-bot-token-here
POSTGRES_DB=dating
POSTGRES_USER=dating
POSTGRES_PASSWORD=secure_password_here
DOMAIN=your-domain.com
WEBAPP_URL=https://your-domain.com
ACME_EMAIL=admin@your-domain.com
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è `POSTGRES_PASSWORD`

### –®–∞–≥ 3: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
docker compose --profile monitoring up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~13 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ Up:
# - traefik (reverse proxy)
# - db (PostgreSQL)
# - bot (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
# - webapp (nginx)
# - prometheus, grafana, loki, promtail (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
# - cadvisor, node-exporter, postgres-exporter (—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã –º–µ—Ç—Ä–∏–∫)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker compose logs bot | tail -50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
docker compose exec db pg_isready -U dating
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ systemd service –¥–ª—è –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:

```bash
sudo nano /etc/systemd/system/dating-bot.service
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
```ini
[Unit]
Description=Dating Bot
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/dating
ExecStart=/usr/bin/docker compose --profile monitoring up -d
ExecStop=/usr/bin/docker compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ:
```bash
sudo systemctl daemon-reload
sudo systemctl enable dating-bot.service
sudo systemctl start dating-bot.service
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ß–µ—Ä–µ–∑ CI/CD

–ü—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ main –≤–µ—Ç–∫—É - –¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –í—Ä—É—á–Ω—É—é

```bash
cd /opt/dating

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â–∏–π .env
cp .env .env.backup

# –ü–æ–ª—É—á–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose --profile monitoring up -d --build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps
```

---

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose logs -f

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker compose logs -f bot

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker compose logs --tail=100 bot

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
docker compose logs --since 1h bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/Memory –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker stats

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
docker system df
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://your-server:3000
2. –õ–æ–≥–∏–Ω: `admin`, –ü–∞—Ä–æ–ª—å: `admin` (–∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Dashboards**
4. –í—ã–±–µ—Ä–∏—Ç–µ **Dating App - Overview**

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
- Active users (24h / 7d)
- Total matches
- Match rate
- Container resources
- Database performance

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã (–≤ Prometheus):
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–ø–∞–ª (>1 –º–∏–Ω—É—Ç–∞)
- PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (>1 –º–∏–Ω—É—Ç–∞)
- Memory usage >90% (>5 –º–∏–Ω—É—Ç)
- CPU usage >80% (>10 –º–∏–Ω—É—Ç)
- Disk space <10% (>5 –º–∏–Ω—É—Ç)

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Alertmanager (—Å–º. [monitoring/README.md](../monitoring/README.md)).

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ cron job:

```bash
sudo nano /etc/cron.daily/dating-backup
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
```bash
#!/bin/bash
BACKUP_DIR="/opt/backups/dating"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

# Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker compose -f /opt/dating/docker-compose.yml exec -T db \
  pg_dump -U dating dating | gzip > "$BACKUP_DIR/db_$DATE.sql.gz"

# –£–¥–∞–ª–∏—Ç—å backups —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find "$BACKUP_DIR" -name "db_*.sql.gz" -mtime +30 -delete

echo "Backup completed: $BACKUP_DIR/db_$DATE.sql.gz"
```

–°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
sudo chmod +x /etc/cron.daily/dating-backup
```

### –†—É—á–Ω–æ–π backup

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker compose exec db pg_dump -U dating dating | gzip > backup-$(date +%Y%m%d).sql.gz

# –í—Å–µ volumes
docker run --rm \
  -v dating_postgres_data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/volumes-$(date +%Y%m%d).tar.gz /data
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
gunzip < backup-20240101.sql.gz | docker compose exec -T db psql -U dating dating

# –ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
docker compose down -v  # ‚ö†Ô∏è —É–¥–∞–ª–∏—Ç —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
docker compose up -d
gunzip < backup-20240101.sql.gz | docker compose exec -T db psql -U dating dating
```

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–£–≤–µ–ª–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –≤ docker-compose.yml:

```yaml
bot:
  deploy:
    resources:
      limits:
        memory: 1G  # –±—ã–ª–æ 512M
        cpus: '2'   # –±—ã–ª–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ
```

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è multi-instance –¥–µ–ø–ª–æ—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. Redis –¥–ª—è shared state
2. Load balancer
3. Message queue

–°–º. [ROADMAP.md](../ROADMAP.md) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä bot –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs bot

# –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π BOT_TOKEN
# 2. –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
# 3. –û—à–∏–±–∫–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker compose exec db pg_isready -U dating

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ BOT_TOKEN
grep BOT_TOKEN .env

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose up -d --build bot
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: –û—à–∏–±–∫–∞ "could not connect to server"

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ë–î
docker compose ps db

# –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä stopped
docker compose up -d db

# –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–∏–ª—Å—è - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å volume
# ‚ö†Ô∏è –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ! –°–¥–µ–ª–∞–π—Ç–µ backup —Å–Ω–∞—á–∞–ª–∞
docker compose exec db pg_dump -U dating dating > backup.sql
docker compose down -v
docker compose up -d
docker compose exec -T db psql -U dating dating < backup.sql
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: "Failed to obtain certificate"

**–ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è**:

1. **DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig +short your-domain.com
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞
```

2. **–ü–æ—Ä—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
sudo ufw status
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

3. **–õ–∏–º–∏—Ç Let's Encrypt**:
   - Staging: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ACME_CA_SERVER=https://acme-staging-v02.api.letsencrypt.org/directory`
   - Production: –º–∞–∫—Å 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –Ω–µ–¥–µ–ª—é

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Traefik**:
```bash
docker compose logs traefik | grep -i certificate
```

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ**:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–º—è—Ç—å
docker stats

# –û–±—ã—á–Ω–æ –≤–∏–Ω–æ–≤–Ω–∏–∫–∏:
# 1. Prometheus - —É–º–µ–Ω—å—à–∏—Ç–µ retention
# 2. Loki - —É–º–µ–Ω—å—à–∏—Ç–µ retention
# 3. Grafana - –æ—Ç–∫–ª—é—á–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ plugins

# –î–ª—è Prometheus –∏–∑–º–µ–Ω–∏—Ç–µ –≤ docker-compose.yml (–≤ —Å–µ–∫—Ü–∏–∏ prometheus):
# '--storage.tsdb.retention.time=15d'  # –±—ã–ª–æ 30d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose --profile monitoring up -d --force-recreate prometheus
```

### –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
docker system df -v

# –û—á–∏—Å—Ç–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ
docker system prune -a -f

# –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
sudo journalctl --vacuum-time=7d

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤ Docker
sudo nano /etc/docker/daemon.json
```

–î–æ–±–∞–≤—å—Ç–µ:
```json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker:
```bash
sudo systemctl restart docker
docker compose --profile monitoring up -d
```

---

## Best Practices

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:
   - Grafana admin (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥)
   - PostgreSQL (–≤ .env)

2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º**:
```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
sudo ufw deny 3000  # Grafana
sudo ufw deny 9090  # Prometheus
sudo ufw allow from <your-ip> to any port 3000  # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–µ–≥–æ IP
```

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ**:
```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã
docker compose pull
docker compose --profile monitoring up -d
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–í–∫–ª—é—á–∏—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö)
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ slow queries** —á–µ—Ä–µ–∑ Grafana
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (Redis - —Å–º. ROADMAP)

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backups** (—Å–º. –≤—ã—à–µ)
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è** –µ–∂–µ–º–µ—Å—è—á–Ω–æ
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∞–ª–µ—Ä—Ç—ã** –≤ Grafana
4. **–í–µ–¥–∏—Ç–µ changelog** –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–ø–æ—Ä—Ç—ã 22, 80, 443)
- [ ] –°–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ GitHub
- [ ] BOT_TOKEN –≤–∞–ª–∏–¥–µ–Ω –∏ –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
- [ ] DOMAIN —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–º–µ–Ω—É
- [ ] .env —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç prod –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –ü–∞—Ä–æ–ª—å –ë–î –±–µ–∑–æ–ø–∞—Å–Ω—ã–π (–Ω–µ "dating")
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç (Grafana –¥–æ—Å—Ç—É–ø–Ω–∞)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω (https —Ä–∞–±–æ—Ç–∞–µ—Ç)
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram
- [ ] WebApp –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

---

## –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

- üìñ [–û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md)
- üèóÔ∏è [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](ARCHITECTURE.md)
- üöÄ [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](GETTING_STARTED.md)
- üêõ [–°–æ–∑–¥–∞—Ç—å issue](https://github.com/erliona/dating/issues)

---

**–£—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è! üöÄ**
